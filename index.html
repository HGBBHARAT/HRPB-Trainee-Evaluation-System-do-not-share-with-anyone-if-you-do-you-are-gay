<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HRBRP | Training Assist</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script>
        const CONFIG = {
            // Split Webhooks
            WEBHOOK_ANN: "https://discord.com/api/webhooks/1458886199509909661/qKwvbqtN_3B9hgxnznvECPOEwKgl8V94acNRPad8Q95JGWsisLIZak7K7tvXVSQ4kFW7", // Announcements Only
            WEBHOOK_RES: "https://discord.com/api/webhooks/1453719023576547569/CWbH_-IdX5cQsAq0TDmbX_o-pHyDI62zjdEpl4qo8dmt-8kW7P861KA0OQ1Ru3ZfkDxz", // Results & Voice Verification
            
            ANNOUNCE_ROLE_ID: "1381367978611839136",
            ACCESS_KEY: "bff7389rbf3g87f82903jdf3rh43fr4hgb",
            LOGO_THUMB: "https://cdn.discordapp.com/attachments/1434075893868920852/1453697701366730802/hrbrp.png?ex=694e64fc&is=694d137c&hm=4352d63613a4a1aaf888d10dfeb4cf9277354ee2a30d1a35435593d08ae27aff&",
            IMG_ANN: "https://cdn.discordapp.com/attachments/1434075893868920852/1453697838994296855/HRPBRP_Announcement.png?ex=694e651d&is=694d139d&hm=bddd0e4606a65f2ef23ed92415cf287deac61a0591eb70b6e2c1f4fe46d2ece1&",
            IMG_RES: "https://cdn.discordapp.com/attachments/1434075893868920852/1453697757872394321/HRBRP___TER.png?ex=694e6509&is=694d1389&hm=44aa6543d96fe1e144976eb8f840fe301dc50e769f08bc73a0ba043a1b75c0c3&",
            IMG_VV: "https://cdn.discordapp.com/attachments/1434075893868920852/1453697795138523268/HRBRP_VV_Results.png?ex=694e6512&is=694d1392&hm=a65b443a3b6d596abf0b0215de48eaab071639daafa9be4d2e5381f17d49239f&"
        };
    </script>
    <style>
        :root {
            --bg: #05070a; --panel: rgba(16, 20, 35, 0.95);
            --pink: #ff00ff; --blue: #00f2ff; --gold: #ffcc00;
            --pass: #00ff88; --fail: #ff4444; --text: #ffffff;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at top right, #1a0b2e, #05070a);
            color: var(--text); margin: 0;
            display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh;
        }

        #login-screen { background: var(--panel); padding: 50px; border: 2px solid var(--pink); border-radius: 20px; text-align: center; }

        #dashboard {
            display: none; width: 95%; max-width: 1100px; background: var(--panel);
            backdrop-filter: blur(15px); border-radius: 24px; border: 1px solid rgba(255, 255, 255, 0.1); overflow: hidden;
            margin-bottom: 20px; position: relative;
        }

        .tabs { display: flex; background: rgba(0,0,0,0.4); }
        .tab { flex: 1; padding: 20px; text-align: center; cursor: pointer; color: #666; font-weight: 800; text-transform: uppercase; font-size: 0.85rem; }
        .tab.active { color: var(--blue); border-bottom: 3px solid var(--blue); background: rgba(0, 242, 255, 0.05); }

        .content { padding: 40px; display: none; padding-bottom: 20px; }
        .content.active { display: block; }

        label { display: block; margin-top: 15px; color: var(--blue); font-size: 0.75rem; font-weight: 800; text-transform: uppercase; }
        input, textarea, select {
            background: rgba(0,0,0,0.4); border: 1px solid var(--blue); color: white; padding: 12px; 
            width: 100%; border-radius: 8px; margin-top: 5px; font-family: inherit; box-sizing: border-box;
        }

        .toggle-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
        .t-btn { padding: 12px; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: white; border-radius: 8px; font-weight: bold; font-size: 0.75rem; }
        .t-btn.yes-active { background: var(--pass); color: #000; }
        .t-btn.no-active { background: var(--fail); color: #fff; }

        .primary-btn {
            background: var(--blue); color: black; border: none; padding: 18px; width: 100%; border-radius: 12px;
            font-weight: 800; cursor: pointer; margin-top: 25px; text-transform: uppercase;
        }
        
        .dashboard-footer {
            padding: 15px; font-size: 0.75rem; color: rgba(255,255,255,0.4); text-align: center; 
            border-top: 1px solid rgba(255,255,255,0.05); background: rgba(0,0,0,0.2);
        }
        .dashboard-footer a { color: var(--pink); text-decoration: none; font-weight: bold; }

        .batch-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .card-controls { display: flex; gap: 8px; }
        .control-btn { padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.7rem; font-weight: 800; border: none; text-transform: uppercase; transition: 0.2s; }
        .edit-btn { background: var(--blue); color: #000; }
        .edit-btn:hover { background: #00d2dd; }
        .rem-btn { background: var(--fail); color: #fff; }
        .rem-btn:hover { background: #dd3333; }
    </style>
</head>
<body>

    <div id="login-screen">
        <h1 style="color: var(--gold); font-weight: 800;">HRBRP | Training Assist</h1>
        <input type="password" id="pass-field" style="text-align:center" placeholder="ACCESS KEY">
        <button onclick="unlock()" class="primary-btn">INITIALIZE</button>
    </div>

    <div id="dashboard">
        <div class="tabs">
            <div class="tab active" id="tab-ann" onclick="switchTab('ann')">Announcements</div>
            <div class="tab" id="tab-res" onclick="switchTab('res')">Training Results</div>
            <div class="tab" id="tab-voice" onclick="switchTab('voice')">Voice Verification</div>
        </div>

        <div id="ann-content" class="content active">
            <h2>ANNOUNCEMENT SYSTEM</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div><label>Trainer Discord ID</label><input type="text" id="ann-uid"></div>
                <div><label>Training Type</label><input type="text" id="ann-type" value="Normal Training"></div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div><label>Location</label><input type="text" id="ann-loc" value="Sheriff Briefing Room"></div>
                <div><label>Start Date & Time</label><input type="datetime-local" id="ann-time"></div>
            </div>
            <label>Description/Sections</label>
            <textarea id="ann-desc" rows="2">Knowledge Section, Mod Call Section and Driving Section. Tick if attending.</textarea>
            <label>Additional Info</label>
            <textarea id="ann-info" rows="2"></textarea>
            <button onclick="postAnn()" class="primary-btn">ANNOUNCE</button>
        </div>

        <div id="res-content" class="content">
            <h2>BATCH EVALUATOR</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px;">
                <div><label>Host Roblox</label><input type="text" id="h-rblx" oninput="saveHost()"></div>
                <div><label>Host Discord ID</label><input type="text" id="h-id" oninput="saveHost()"></div>
            </div>

            <div style="margin-top: 30px; padding: 25px; border: 1px solid var(--pink); border-radius: 20px;">
                <h3 style="color: var(--pink); margin-top: 0;">TRAINEE INPUT</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <input type="text" id="t-rblx" placeholder="Roblox Username">
                    <input type="text" id="t-id" placeholder="Discord User ID">
                </div>
                <label>Knowledge (Max 10)</label><input type="number" id="t-know" max="10">
                <label>Knowledge Notes</label><textarea id="t-know-notes"></textarea>
                <div class="toggle-row">
                    <div><label>Used proper SPAG?</label><div style="display:flex;gap:5px"><button class="t-btn" id="s-y" onclick="setTog('spag',true)">Y</button><button class="t-btn" id="s-n" onclick="setTog('spag',false)">N</button></div></div>
                    <div><label>HEALED?</label><div style="display:flex;gap:5px"><button class="t-btn" id="h-y" onclick="setTog('heal',true)">Y</button><button class="t-btn" id="h-n" onclick="setTog('heal',false)">N</button></div></div>
                    <div><label>Punished Accordingly?</label><div style="display:flex;gap:5px"><button class="t-btn" id="p-y" onclick="setTog('punish',true)">Y</button><button class="t-btn" id="p-n" onclick="setTog('punish',false)">N</button></div></div>
                    <div><label>Used Proper Evidence?</label><div style="display:flex;gap:5px"><button class="t-btn" id="e-y" onclick="setTog('evid',true)">Y</button><button class="t-btn" id="e-n" onclick="setTog('evid',false)">N</button></div></div>
                </div>
                <label>Mod-Call Notes</label><textarea id="t-mod-notes"></textarea>
                <button onclick="addTrainee()" class="primary-btn" style="background: var(--pass)">ADD TO BATCH</button>
            </div>
            <div id="batch-list" style="margin-top: 20px;"></div>
            <button id="publish-btn" onclick="publish()" class="primary-btn" style="background: var(--pink); color: white; display: none;">PUBLISH RESULTS</button>
        </div>

        <div id="voice-content" class="content">
            <h2>VOICE VERIFICATION UNIT</h2>
            <label>Trainer/Host Discord ID</label>
            <input type="text" id="v-trainer-uid">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                <div><label>Trainee Discord ID</label><input type="text" id="v-trainee-uid"></div>
                <div><label>Trainee Username</label><input type="text" id="v-trainee-name"></div>
            </div>
            <label>Age Group</label>
            <select id="v-age">
                <option value="Under 13">Under 13</option>
                <option value="13-15">13-15</option>
                <option value="15-17">15-17</option>
                <option value="18+">18+</option>
            </select>
            <button onclick="postVoiceVerify()" class="primary-btn" style="background: var(--gold); color: black;">SUBMIT VERIFICATION</button>
        </div>

        <div class="dashboard-footer">
            Still in development phase to report bugs, contact <a href="https://discord.com/users/hgb_bharat" target="_blank">@hgb_bharat üåê</a>
        </div>
    </div>

    <script>
        let batch = [];
        let toggles = { spag: null, heal: null, punish: null, evid: null };

        function unlock() {
            if(document.getElementById('pass-field').value === CONFIG.ACCESS_KEY) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                loadHost();
            } else { alert("ACCESS DENIED"); }
        }

        function saveHost() {
            localStorage.setItem('hr_host_rblx', document.getElementById('h-rblx').value);
            localStorage.setItem('hr_host_id', document.getElementById('h-id').value);
        }

        function loadHost() {
            document.getElementById('h-rblx').value = localStorage.getItem('hr_host_rblx') || "";
            document.getElementById('h-id').value = localStorage.getItem('hr_host_id') || "";
        }

        function switchTab(t) {
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(t + '-content').classList.add('active');
            document.getElementById('tab-' + t).classList.add('active');
        }

        function setTog(k, v) {
            toggles[k] = v;
            const p = k.charAt(0);
            document.getElementById(p + '-y').className = v ? 't-btn yes-active' : 't-btn';
            document.getElementById(p + '-n').className = !v ? 't-btn no-active' : 't-btn';
        }

        function removeTrainee(index) {
            const traineeName = batch[index].rblx;
            if(confirm(`Are you sure you want to REMOVE "${traineeName}" from the batch?`)) {
                batch.splice(index, 1);
                renderBatch();
            }
        }

        function editTrainee(index) {
            const t = batch[index];
            document.getElementById('t-rblx').value = t.rblx;
            document.getElementById('t-id').value = t.id;
            document.getElementById('t-know').value = t.know;
            document.getElementById('t-know-notes').value = t.knowNotes;
            document.getElementById('t-mod-notes').value = t.modNotes;
            setTog('spag', t.toggles.spag);
            setTog('heal', t.toggles.heal);
            setTog('punish', t.toggles.punish);
            setTog('evid', t.toggles.evid);
            
            batch.splice(index, 1);
            renderBatch();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function addTrainee() {
            const rblx = document.getElementById('t-rblx').value;
            const tid = document.getElementById('t-id').value;
            if(!rblx || !tid) return alert("Missing info.");
            let knowRaw = parseInt(document.getElementById('t-know').value) || 0;
            const mod = Object.values(toggles).filter(v => v === true).length * 2.5;
            const total = Math.min(knowRaw, 10) + mod;
            batch.push({
                rblx, id: tid, score: total, status: total >= 14 ? "PASS" : "FAIL",
                know: knowRaw, knowNotes: document.getElementById('t-know-notes').value || "N/A",
                modNotes: document.getElementById('t-mod-notes').value || "N/A",
                toggles: {...toggles}
            });
            renderBatch(); clearForm();
        }

        function renderBatch() {
            const out = document.getElementById('batch-list');
            out.innerHTML = batch.length ? "<h3>CURRENT BATCH</h3>" : "";
            batch.forEach((t, i) => {
                out.innerHTML += `<div class="batch-card">
                    <div><strong>${t.rblx}</strong> - ${t.score}/20 (${t.status})</div>
                    <div class="card-controls">
                        <button class="control-btn edit-btn" onclick="editTrainee(${i})">Edit</button>
                        <button class="control-btn rem-btn" onclick="removeTrainee(${i})">Remove</button>
                    </div>
                </div>`;
            });
            document.getElementById('publish-btn').style.display = batch.length ? 'block' : 'none';
        }

        function clearForm() {
            ['t-rblx', 't-id', 't-know', 't-know-notes', 't-mod-notes'].forEach(id => document.getElementById(id).value = "");
            toggles = { spag: null, heal: null, punish: null, evid: null };
            document.querySelectorAll('.t-btn').forEach(b => b.className = 't-btn');
        }

        // POSTS TO ANNOUNCEMENT WEBHOOK
        async function postAnn() {
            const uid = document.getElementById('ann-uid').value;
            const unix = Math.floor(new Date(document.getElementById('ann-time').value).getTime() / 1000);
            const body = {
                content: `<@${uid}> <@&${CONFIG.ANNOUNCE_ROLE_ID}>,<@&1381367973997969409>`,
                embeds: [{
                    title: "New Training Announced!", color: 16711935,
                    thumbnail: { url: CONFIG.LOGO_THUMB },
                    image: { url: CONFIG.IMG_ANN },
                    fields: [
                        { name: "Training Type:", value: document.getElementById('ann-type').value },
                        { name: "Date & Time", value: `<t:${unix}:F>` },
                        { name: "Location", value: document.getElementById('ann-loc').value },
                        { name: "Notes", value: document.getElementById('ann-desc').value },
                        { name: "Additional Info", value: document.getElementById('ann-info').value || "None" }
                    ]
                }]
            };
            await fetch(CONFIG.WEBHOOK_ANN, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(body) });
            alert("Broadcast sent.");
        }

        // POSTS TO RESULTS/VOICE WEBHOOK
        async function postVoiceVerify() {
            const tID = document.getElementById('v-trainer-uid').value;
            const trID = document.getElementById('v-trainee-uid').value;
            const age = document.getElementById('v-age').value;
            const isPass = age !== "Under 13";
            const body = {
                content: `<@${trID}> <@${tID}>`,
                embeds: [{
                    title: "VOICE VERIFICATION RESULTS", color: isPass ? 65280 : 16711680,
                    thumbnail: { url: CONFIG.LOGO_THUMB },
                    image: { url: CONFIG.IMG_VV },
                    fields: [
                        { name: "User :", value: `**${document.getElementById('v-trainee-name').value}**` },
                        { name: "Host :", value: `<@${tID}>` },
                        { name: "Age Group :", value: `**${age}**` },
                        { name: "Results :", value: isPass ? "‚úÖ **PASS**" : "‚ùå **FAIL (UNDERAGE)**" }
                    ]
                }]
            };
            await fetch(CONFIG.WEBHOOK_RES, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(body) });
            alert("Verification Sent.");
        }

        // POSTS TO RESULTS/VOICE WEBHOOK
        async function publish() {
            if(!confirm("Are you sure you want to publish these results to Discord?")) return;
            const hId = document.getElementById('h-id').value;
            let pings = `<@${hId}> `;
            batch.forEach(t => pings += `<@${t.id}> `);
            const embeds = batch.map((t, index) => {
                const embed = {
                    title: `TRAINING EVALUATION: ${t.status}`, color: t.status === "PASS" ? 65280 : 16711680,
                    thumbnail: { url: CONFIG.LOGO_THUMB },
                    fields: [
                        { name: "Host", value: document.getElementById('h-rblx').value + ` (<@${hId}>)`, inline: true },
                        { name: "Candidate", value: t.rblx + ` (<@${t.id}>)`, inline: true },
                        { name: "Score", value: `${t.score}/20`, inline: true },
                        { name: "Notes", value: `Question and Answer Section: ${t.knowNotes}\nMod Call Section: ${t.modNotes}` }
                    ]
                };
                if (index === batch.length - 1) embed.image = { url: CONFIG.IMG_RES };
                return embed;
            });
            await fetch(CONFIG.WEBHOOK_RES, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ content: pings, embeds }) });
            alert("Published Successfully."); batch = []; renderBatch();
        }
    </script>
</body>
</html>
