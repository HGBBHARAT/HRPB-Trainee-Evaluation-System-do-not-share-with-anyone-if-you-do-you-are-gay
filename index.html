<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HRPB Trainee Evaluation </title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'slate': {
                            700: '#334155', // Customizing the palette used in the JSX
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Basic styling for the dark background */
        body {
            background-color: #0f172a; /* slate-900 */
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        }
        /* Hide number input spinners */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none;
          margin: 0; 
        }
        /* Style for date/time inputs in dark mode */
        input[type="date"], input[type="time"] {
             color-scheme: dark; /* Force dark scheme for the picker UI */
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        // --- Mocking Lucide Icons (only the ones used in the code) ---
        const User = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
        const Loader2 = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/><animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite" /></svg>;
        const List = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>;
        const XCircle = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>;
        const Plus = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>;
        const Save = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><path d="M17 21v-2a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v2"/><path d="M7 3v4h10"/></svg>;
        const Trash2 = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>;
        const Shield = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>;
        const GitBranch = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="6" x2="6" y1="3" y2="15"/><circle cx="18" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><path d="M18 9a9 9 0 0 1-9 9"/></svg>;
        const Target = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>;
        const AlertTriangle = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>;
        const MessageSquare = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>;
        const Mic = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></svg>;
        const Car = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 17h2c.6 0 1-.4 1-1v-4c0-.7-.4-1-1-1h-1V7c0-2.2-1.8-4-4-4H7c-2.2 0-4 1.8-4 4v7c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/><path d="M18 7H6"/><path d="M8 10h6"/></svg>;
        const Volume2 = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>;
        const Clock = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const Send = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>;
        
        // --- NEW ICONS ADDED FOR ANNOUNCEMENT TAB ---
        const Calendar = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>);
        const Copy = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/><rect x="2" y="2" width="20" height="20" rx="2" ry="2" style={{opacity: 0}} /></svg>);
        const AlertCircle = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>);

        // --- Utility Constants ---
        const initialTraineeState = {
            traineeDiscordId: '',
            traineeRobloxUsername: '',
            traineeName: '',
            knowledgeScore: '',
            knowledgeNotes: '',
            modGoodEnglish: null, 
            modAskedForProof: null, 
            modHealedTrainer: null, 
            modPunishedCorrectly: null, 
            modNotes: '',
            weaponDeaths: '',
            weaponKilledSniper: null,
            status: 'pending', // 'pending', 'passed', 'failed', 'disqualified', 'processing'
        };
        
        const initialVoiceTraineeState = {
            traineeDiscordId: '',
            traineeRobloxUsername: '',
            traineeName: '',
            verified: null, // 'true' or 'false'
            status: 'pending', // 'pending', 'verified', 'denied', 'processing'
        };
        const WeaponDeathOptions = [
            { value: '', label: 'Select death count' },
            { value: '0', label: '0 Times Died' },
            { value: '1', label: '1 Time Died' },
            { value: '2', label: '2 Times Died' },
            { value: '3', label: '3 Times Died' },
            { value: '3+', label: '3+ Times Died' },
        ];
        const ScoreOptions = Array.from({ length: 11 }, (_, i) => i).map(n => ({
            value: n.toString(),
            label: n.toString(),
        }));
        // --- Utility Functions ---

        const checkTraineeRequiredFields = (trainee) => {
            if (!trainee.traineeDiscordId || !trainee.traineeRobloxUsername || !trainee.traineeName) return false;
            if (trainee.knowledgeScore === '' || 
                trainee.modGoodEnglish === null || 
                trainee.modAskedForProof === null || 
                trainee.modHealedTrainer === null || 
                trainee.modPunishedCorrectly === null || 
                trainee.weaponDeaths === '' || 
                trainee.weaponKilledSniper === null) 
            {
                return false;
            }
            return true;
        };
        const checkVoiceTraineeRequiredFields = (trainee) => {
             if (!trainee.traineeDiscordId || !trainee.traineeRobloxUsername || !trainee.traineeName) return false;
             if (trainee.verified === null) return false;
             return true;
        };

        const mockServerTimestamp = () => new Date().toISOString();
        const mockAddDoc = async (data) => {
            console.log("MOCK API CALL: Evaluation Submitted. Data:", data);
            await new Promise(resolve => setTimeout(resolve, 500)); 
            // In a real application, you would send this to your webhook URL here.
            return { id: Math.random().toString(36).substring(2, 9) };
        };


        // --- ToggleGroup component (required by the form) ---
        const ToggleGroup = ({ label, value, onChange, required = true }) => {
            
            const handleToggle = (newValue) => {
                if (value === newValue) {
                    onChange(null);
                } else {
                    onChange(newValue);
                }
            };

            const baseClasses = "flex-1 py-2 px-3 rounded-lg text-sm font-medium transition duration-150 border";
            const yesClasses = value === true 
                ? "bg-emerald-600 border-emerald-600 text-white shadow-md hover:bg-emerald-500" 
                : "bg-slate-700 border-slate-600 text-slate-300 hover:bg-slate-600";
            const noClasses = value === false 
                ? "bg-rose-600 border-rose-600 text-white shadow-md hover:bg-rose-500" 
                : "bg-slate-700 border-slate-600 text-slate-300 hover:bg-slate-600";
            const isRequiredClass = required && value === null ? 'border-dashed border-rose-500' : 'border-slate-700';

            return (
                <div className="flex flex-col space-y-2">
                    <span className={`text-sm font-medium ${required ? 'text-slate-200' : 'text-slate-400'}`}>
                        {label}
                        {required && value === null && <span className="text-rose-500 ml-1"> (Required)</span>}
                    </span>
                    <div className={`flex space-x-3 p-1 rounded-xl bg-slate-700 ${isRequiredClass}`}>
                        <button
                            type="button"
                            onClick={() => handleToggle(true)}
                            className={`${baseClasses} ${yesClasses}`}
                        >
                            Yes
                        </button>
                        <button
                            type="button"
                            onClick={() => handleToggle(false)}
                            className={`${baseClasses} ${noClasses}`}
                        >
                            No
                        </button>
                    </div>
                </div>
            );
        };
        
        // --- TabButton Component ---
        const TabButton = ({ icon: Icon, label, isActive, onClick }) => (
            <button
                className={`flex items-center text-sm font-medium py-3 px-4 rounded-lg transition-colors duration-200 ${
                    isActive 
                        ? 'text-white bg-indigo-600 shadow-lg' 
                        : 'text-slate-400 hover:text-white hover:bg-slate-700'
                }`}
                onClick={onClick}
            >
                <Icon className="w-5 h-5 mr-2" />
                {label}
            </button>
        );


        // --- EvaluationForm (Submit Results Tab Content) ---
        // (Other components like TraineeAssessmentSection, TraineeActionButtons, DisqualificationModal are assumed to be defined here)
        
        const TraineeActionButtons = ({ trainee, index, onFinalize, onDisqualify, isValid }) => {
            let statusClasses = "text-sm font-semibold px-3 py-1 rounded-full";
            let statusText = "";

            if (trainee.status === 'pending') {
                statusClasses += " bg-slate-600 text-white";
                statusText = "Pending Evaluation";
            } else if (trainee.status === 'passed') {
                statusClasses += " bg-emerald-600 text-white";
                statusText = "PASSED";
            } else if (trainee.status === 'failed') {
                statusClasses += " bg-yellow-600 text-white";
                statusText = "FAILED";
            } else if (trainee.status === 'disqualified') {
                statusClasses += " bg-rose-600 text-white";
                statusText = "DISQUALIFIED";
            } else if (trainee.status === 'processing') {
                statusClasses += " bg-sky-600 text-white";
                statusText = "Processing...";
            }
            
            const isReadyForFinalize = isValid && trainee.status === 'pending';
            const isReadyForDisqualify = 
                trainee.status === 'pending' && 
                trainee.traineeDiscordId.trim() && 
                trainee.traineeRobloxUsername.trim() && 
                trainee.traineeName.trim();

            return (
                <div className="pt-4 border-t border-slate-600">
                    <h4 className="text-lg font-bold text-white mb-3">Final Action</h4>
                    <div className="flex items-center justify-between">
                        <span className={statusClasses}>{statusText}</span>
                        <div className="flex space-x-3">
                            {trainee.status === 'pending' && (
                                <>
                                    <button
                                        type="button"
                                        onClick={onDisqualify}
                                        disabled={!isReadyForDisqualify || trainee.status === 'processing'}
                                        className="flex items-center bg-rose-700 hover:bg-rose-600 text-white font-medium py-2 px-4 rounded-lg text-sm transition duration-200 disabled:bg-slate-700 disabled:text-slate-500 disabled:cursor-not-allowed shadow-md"
                                    >
                                        <XCircle className="w-4 h-4 mr-1" /> Disqualify
                                    </button>

                                    <button
                                        type="button"
                                        onClick={onFinalize}
                                        disabled={!isReadyForFinalize || trainee.status === 'processing'}
                                        className="flex items-center bg-emerald-700 hover:bg-emerald-600 text-white font-medium py-2 px-4 rounded-lg text-sm transition duration-200 disabled:bg-slate-700 disabled:text-slate-500 disabled:cursor-not-allowed shadow-md"
                                    >
                                        <Save className="w-4 h-4 mr-1" /> Save Result
                                    </button>
                                </>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const TraineeAssessmentSection = ({ trainee, index, onUpdate, onRemove, onFinalize, onDisqualify, isRemovable, requiredFieldsValid }) => (
            <section 
                className="space-y-4 p-5 bg-slate-700 rounded-xl border border-slate-600 relative opacity-100 transition-opacity duration-300"
                style={trainee.status !== 'pending' ? {opacity: 0.7} : {}} 
            >
                <h3 className="text-xl font-bold text-white mb-4 flex justify-between items-center">
                    Trainee #{index + 1}
                    {isRemovable && (
                        <button
                            type="button"
                            onClick={onRemove}
                            className="text-rose-400 hover:text-rose-300 p-1 rounded-full hover:bg-slate-600 transition"
                            aria-label={`Remove Trainee ${index + 1}`}
                        >
                            <Trash2 className="w-5 h-5" />
                        </button>
                    )}
                </h3>
                
                {/* Trainee Information */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 pb-4 border-b border-slate-600">
                    <div className="space-y-1">
                        <label className="block text-sm font-medium text-slate-200">
                            Discord ID (Numbers Only) <span className="text-rose-500">*</span>
                        </label>
                        <input
                            type="number"
                            placeholder="123456789012345678"
                            value={trainee.traineeDiscordId}
                            onChange={(e) => onUpdate('traineeDiscordId', e.target.value)}
                            className="w-full p-3 rounded-lg bg-slate-800 border border-slate-600 text-white placeholder-slate-400 focus:ring-sky-500 focus:border-sky-500"
                            required
                        />
                    </div>
                    <div className="space-y-1">
                        <label className="block text-sm font-medium text-slate-200">
                            Roblox Username <span className="text-rose-500">*</span>
                        </label>
                        <input
                            type="text"
                            placeholder="Trainee's Roblox username"
                            value={trainee.traineeRobloxUsername}
                            onChange={(e) => onUpdate('traineeRobloxUsername', e.target.value)}
                            className="w-full p-3 rounded-lg bg-slate-800 border border-slate-600 text-white placeholder-slate-400 focus:ring-sky-500 focus:border-sky-500"
                            required
                        />
                    </div>
                    <div className="space-y-1">
                        <label className="block text-sm font-medium text-slate-200">
                            Name <span className="text-rose-500">*</span>
                        </label>
                        <input
                            type="text"
                            placeholder="Trainee's display name"
                            value={trainee.traineeName}
                            onChange={(e) => onUpdate('traineeName', e.target.value)}
                            className="w-full p-3 rounded-lg bg-slate-800 border border-slate-600 text-white placeholder-slate-400 focus:ring-sky-500 focus:border-sky-500"
                            required
                        />
                    </div>
                </div>

                {/* Knowledge Assessment */}
                <div className="space-y-4 pt-4">
                    <h4 className="text-lg font-bold text-white flex items-center">
                        <GitBranch className="w-4 h-4 mr-2 text-sky-400" />
                        Knowledge
                    </h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-1">
                            <label htmlFor={`knowledgeScore-${index}`} className="block text-sm font-medium text-slate-200">
                                Knowledge Score (0-10) <span className="text-rose-500">*</span>
                            </label>
                            <select
                                id={`knowledgeScore-${index}`}
                                value={trainee.knowledgeScore}
                                onChange={(e) => onUpdate('knowledgeScore', e.target.value)}
                                className="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 text-white focus:ring-sky-500 focus:border-sky-500 appearance-none"
                                required
                            >
                                <option value="" disabled>Select score</option>
                                {ScoreOptions.map(option => (
                                    <option key={option.value} value={option.value}>{option.label}</option>
                                ))}
                            </select>
                        </div>
                        <div className="space-y-1">
                            <label htmlFor={`knowledgeNotes-${index}`} className="block text-sm font-medium text-slate-200">
                                Notes (Optional)
                            </label>
                            <textarea
                                id={`knowledgeNotes-${index}`}
                                placeholder="Additional notes..."
                                value={trainee.knowledgeNotes}
                                onChange={(e) => onUpdate('knowledgeNotes', e.target.value)}
                                rows="1"
                                className="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 text-white placeholder-slate-400 focus:ring-sky-500 focus:border-sky-500 resize-none"
                            />
                        </div>
                    </div>
                </div>
                
                {/* Moderation Scene Assessment */}
                <div className="space-y-4 pt-4 border-t border-slate-600">
                    <h4 className="text-lg font-bold text-white flex items-center">
                        <Shield className="w-4 h-4 mr-2 text-sky-400" />
                        Moderation Scene
                    </h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <ToggleGroup label="Did the trainee use good English and SPAG?" value={trainee.modGoodEnglish} onChange={(val) => onUpdate('modGoodEnglish', val)} />
                        <ToggleGroup label="Did they heal the trainer?" value={trainee.modHealedTrainer} onChange={(val) => onUpdate('modHealedTrainer', val)} />
                        <ToggleGroup label="Did they ask for proof?" value={trainee.modAskedForProof} onChange={(val) => onUpdate('modAskedForProof', val)} />
                        <ToggleGroup label="Did they punish correctly?" value={trainee.modPunishedCorrectly} onChange={(val) => onUpdate('modPunishedCorrectly', val)} />
                    </div>
                    <div className="space-y-1 pt-2">
                        <label htmlFor={`modNotes-${index}`} className="block text-sm font-medium text-slate-200">
                            Moderation Notes (Optional)
                        </label>
                        <textarea
                            id={`modNotes-${index}`}
                            placeholder="Additional notes..."
                            value={trainee.modNotes}
                            onChange={(e) => onUpdate('modNotes', e.target.value)}
                            rows="2"
                            className="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 text-white placeholder-slate-400 focus:ring-sky-500 focus:border-sky-500 resize-none"
                        />
                    </div>
                </div>
                
                {/* Weapon Handling Assessment */}
                <div className="space-y-4 pt-4 border-t border-slate-600">
                    
                    <h4 className="text-lg font-bold text-white flex items-center">
                        <Target className="w-4 h-4 mr-2 text-red-400" />
                        Weapon Handling
                    </h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-1">
                            <label htmlFor={`weaponDeaths-${index}`} className="block text-sm font-medium text-slate-200">
                                Number of times died <span className="text-rose-500">*</span>
                            </label>
                            <select
                                id={`weaponDeaths-${index}`}
                                value={trainee.weaponDeaths}
                                onChange={(e) => onUpdate('weaponDeaths', e.target.value)}
                                className="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 text-white focus:ring-red-500 focus:border-red-500 appearance-none"
                                required
                            >
                                {WeaponDeathOptions.map(option => (
                                    <option key={option.value} value={option.value}>{option.label}</option>
                                ))}
                            </select>
                        </div>
                        <ToggleGroup 
                            label="Did the trainee kill the sniper?" 
                            value={trainee.weaponKilledSniper} 
                            onChange={(val) => onUpdate('weaponKilledSniper', val)} 
                            required={true}
                        />
                    </div>
                </div>
                
                {/* Per-Trainee Action Buttons and Status */}
                <TraineeActionButtons 
                    trainee={trainee}
                    index={index}
                    onFinalize={onFinalize}
                    onDisqualify={onDisqualify}
                    isValid={requiredFieldsValid}
                />
            </section>
        );

        const DisqualificationModal = ({ trainee, traineeIndex, onConfirm, onCancel, trainerUsername, isSaving }) => {
            const [proofLink, setProofLink] = useState('');
            const [reason, setReason] = useState('');
            const [confirmationText, setConfirmationText] = useState('');
            
            const traineeName = trainee.traineeName || `Trainee #${traineeIndex + 1}`;
            const requiredConfirmation = `DISQUALIFY ${traineeName}`;

            const handleConfirm = () => {
                if (confirmationText.toUpperCase() === requiredConfirmation.toUpperCase()) {
                    onConfirm(traineeIndex, proofLink, reason);
                }
            };
            
            return (
                <div className="fixed inset-0 z-50 bg-black bg-opacity-70 flex items-center justify-center p-4">
                    <div className="bg-slate-800 rounded-xl shadow-2xl border border-rose-600 w-full max-w-lg">
                        <div className="p-6 space-y-4">
                            <div className="flex items-center text-rose-400 border-b border-rose-700 pb-3">
                                <AlertTriangle className="w-6 h-6 mr-3" />
                                <h3 className="text-xl font-bold text-white">Confirm Disqualification</h3>
                            </div>

                            <p className="text-slate-300">
                                You are about to **permanently disqualify {traineeName}** from this training session. This action requires mandatory proof.
                            </p>

                            <div className="space-y-1">
                                <label className="block text-sm font-medium text-white">
                                    Evidence Link (Video/Screenshot) <span className="text-rose-500">*</span>
                                </label>
                                <input
                                    type="url"
                                    placeholder="https://i.imgur.com/proof.png or video link"
                                    value={proofLink}
                                    onChange={(e) => setProofLink(e.target.value)}
                                    className="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 text-white placeholder-slate-400 focus:ring-rose-500 focus:border-rose-500"
                                    required
                                />
                            </div>

                            <div className="space-y-1">
                                <label className="block text-sm font-medium text-white">
                                    Reason for Disqualification <span className="text-rose-500">*</span>
                                </label>
                                <textarea
                                    placeholder="Specify the rule they broke or why they are being disqualified."
                                    value={reason}
                                    onChange={(e) => setReason(e.target.value)}
                                    rows="3"
                                    className="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 text-white placeholder-slate-400 focus:ring-rose-500 focus:border-rose-500 resize-none"
                                    required
                                />
                            </div>
                            
                            <div className="space-y-1 pt-3 border-t border-slate-700">
                                <label className="block text-sm font-medium text-rose-300">
                                    Type the following to confirm: <code className="text-rose-400">{requiredConfirmation}</code>
                                </label>
                                <input
                                    type="text"
                                    value={confirmationText}
                                    onChange={(e) => setConfirmationText(e.target.value)}
                                    className="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 text-rose-400 placeholder-slate-500 font-mono focus:ring-rose-500 focus:border-rose-500"
                                />
                            </div>

                            <div className="flex justify-end space-x-3 pt-4">
                                <button
                                    type="button"
                                    onClick={onCancel}
                                    className="px-4 py-2 text-sm font-medium rounded-lg text-slate-300 bg-slate-700 hover:bg-slate-600 transition duration-150"
                                    disabled={isSaving}
                                >
                                    Cancel
                                </button>
                                <button
                                    type="button"
                                    onClick={handleConfirm}
                                    disabled={confirmationText.toUpperCase() !== requiredConfirmation.toUpperCase() || !proofLink.trim() || !reason.trim() || isSaving}
                                    className="flex items-center px-4 py-2 text-sm font-medium rounded-lg text-white bg-rose-600 hover:bg-rose-700 transition duration-150 disabled:bg-rose-900 disabled:text-rose-500 disabled:cursor-not-allowed"
                                >
                                    {isSaving ? (
                                        <>
                                            <Loader2 className="w-4 h-4 animate-spin mr-2" /> Disqualifying...
                                        </>
                                    ) : (
                                        'Disqualify Trainee'
                                    )}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const EvaluationForm = ({ db, userId }) => {
            const [trainerRobloxUsername, setTrainerRobloxUsername] = useState('');
            const [coTrainers, setCoTrainers] = useState([]);
            const [trainees, setTrainees] = useState([initialTraineeState]);
            const [isSaving, setIsSaving] = useState(false);
            const [error, setError] = useState(null);
            const [success, setSuccess] = useState(false);
            const [traineeToDisqualifyIndex, setTraineeToDisqualifyIndex] = useState(null);
            const isDisqualificationModalOpen = traineeToDisqualifyIndex !== null;

            // --- Trainee Management (Max 5) ---
            const addTrainee = () => {
                if (trainees.length < 5) {
                    setTrainees([...trainees, initialTraineeState]);
                    setError(null);
                } else {
                    setError("Maximum of 5 trainees reached.");
                }
            };
            const removeTrainee = (index) => {
                if (trainees.length > 1) {
                    setTrainees(trainees.filter((_, i) => i !== index));
                }
            };
            const updateTrainee = (index, field, value) => {
                const newTrainees = trainees.map((trainee, i) => {
                    if (i === index) {
                        return { ...trainee, [field]: value };
                    }
                    return trainee;
                });
                setTrainees(newTrainees);
            };

            // Co-Trainer Management
            const addCoTrainer = () => {
                if (coTrainers.length === 0) {
                    setCoTrainers([{ username: '' }]);
                }
            };
            const updateCoTrainer = (index, value) => {
                if (index === 0) {
                    setCoTrainers([{ username: value }]);
                }
            };
            const removeCoTrainer = (index) => {
                if (index === 0) {
                    setCoTrainers([]);
                }
            };

            // Helper to generate the base evaluation data object
            const generateEvaluationData = (trainee, status, proofLink = '', reason = '') => ({
                trainerRobloxUsername: trainerRobloxUsername.trim(),
                coTrainers: coTrainers.length === 1 && coTrainers[0].username.trim() ? [coTrainers[0].username.trim()] : [],
                traineeDiscordId: trainee.traineeDiscordId.trim(),
                traineeRobloxUsername: trainee.traineeRobloxUsername.trim(),
                traineeName: trainee.traineeName.trim(),
                assessment: {
                    knowledgeScore: status === 'DISQUALIFIED' ? 0 : Number(trainee.knowledgeScore),
                    knowledgeNotes: trainee.knowledgeNotes.trim(),
                    moderation: {
                        goodEnglish: trainee.modGoodEnglish,
                        askedForProof: trainee.modAskedForProof,
                        healedTrainer: trainee.modHealedTrainer,
                        punishedCorrectly: trainee.modPunishedCorrectly,
                        notes: trainee.modNotes.trim(),
                    },
                    weaponHandling: {
                        deaths: trainee.weaponDeaths,
                        killedSniper: trainee.weaponKilledSniper,
                    },
                    disqualification: status === 'DISQUALIFIED' ? { proofLink, reason } : null,
                },
                timestamp: mockServerTimestamp(),
                userId: userId,
                status: status,
                totalScore: status === 'DISQUALIFIED' ? 0 : Number(trainee.knowledgeScore),
                batchId: crypto.randomUUID(),
            });

            // --- Per-Trainee Submission Logic (PASS/FAIL) ---
            const handleFinalizeTrainee = async (index) => {
                setError(null);
                setSuccess(false);
                const trainee = trainees[index];

                if (!trainerRobloxUsername.trim()) {
                    setError("Please enter the Trainer's Roblox Username.");
                    return;
                }
                if (coTrainers.length === 1 && !coTrainers[0].username.trim()) {
                    setError("Please fill out the Co-Trainer's Roblox Username or remove the field.");
                    return;
                }
                if (!checkTraineeRequiredFields(trainee)) {
                    setError(`Please fill out all required fields for Trainee #${index + 1}.`);
                    return;
                }

                updateTrainee(index, 'status', 'processing');
                setIsSaving(true);
                try {
                    const finalStatus = Number(trainee.knowledgeScore) >= 7 ? 'PASSED' : 'FAILED';
                    const evaluationData = generateEvaluationData(trainee, finalStatus);
                    await mockAddDoc(evaluationData);
                    // Mock the submission
                    updateTrainee(index, 'status', finalStatus.toLowerCase());
                    setSuccess(`Results for Trainee #${index + 1} (${finalStatus}) saved successfully!`);
                    setTimeout(() => setSuccess(false), 5000);
                } catch (err) {
                    console.error("Error saving evaluation:", err);
                    setError(`Failed to save results for Trainee #${index + 1}. Check console for details.`);
                    updateTrainee(index, 'status', 'pending');
                } finally {
                    setIsSaving(false);
                }
            };

            // --- Disqualification Logic ---
            const openIndividualDisqualificationModal = (index) => {
                if (!trainerRobloxUsername.trim()) {
                    setError("Please enter the Trainer's Roblox Username first.");
                    return;
                }
                const trainee = trainees[index];
                if (!trainee.traineeDiscordId || !trainee.traineeRobloxUsername || !trainee.traineeName) {
                    setError("Please fill out the Trainee Name and ID fields before disqualifying.");
                    return;
                }
                setError(null);
                setTraineeToDisqualifyIndex(index);
            };

            const handleDisqualify = async (index, proofLink, reason) => {
                setError(null);
                setSuccess(false);
                const trainee = trainees[index];
                updateTrainee(index, 'status', 'processing');
                setIsSaving(true);
                try {
                    const evaluationData = generateEvaluationData(trainee, 'DISQUALIFIED', proofLink, reason);
                    await mockAddDoc(evaluationData);
                    // Mock the submission
                    updateTrainee(index, 'status', 'disqualified');
                    setSuccess(`Trainee #${index + 1} successfully DISQUALIFIED.`);
                    setTimeout(() => setSuccess(false), 5000);
                } catch (err) {
                    console.error("Error saving disqualification:", err);
                    setError(`Failed to save disqualification for Trainee #${index + 1}. Check console for details.`);
                    updateTrainee(index, 'status', 'pending');
                } finally {
                    setIsSaving(false);
                    setTraineeToDisqualifyIndex(null);
                }
            };

            // Calculate Summary Status for the indicator
            const totalTrainees = trainees.length;
            const processedTrainees = trainees.filter(t => t.status !== 'pending' && t.status !== 'processing').length;
            const passedTrainees = trainees.filter(t => t.status === 'passed').length;
            const summaryText = `${processedTrainees}/${totalTrainees} Trainees Processed, ${passedTrainees} Passed`;
            const traineeToDisqualify = isDisqualificationModalOpen ? trainees[traineeToDisqualifyIndex] : null;

            // --- Render ---
            return (
                <>
                    <div className="p-6 bg-slate-800 rounded-xl shadow-2xl border border-slate-700 w-full">
                        <h2 className="text-2xl font-bold text-white mb-6 flex items-center">
                            <List className="w-6 h-6 mr-2 text-sky-400" /> Submit Training Results
                        </h2>
                        <p className="text-slate-400 mb-6 border-b border-slate-700 pb-4"> 
                            Evaluate each trainee individually. Results are posted on submission. (Mock API in use) 
                        </p>

                        {/* Trainer Information Section */}
                        <section className="space-y-4 mb-8">
                            <h3 className="text-xl font-bold text-white flex items-center">
                                <User className="w-5 h-5 mr-2 text-sky-400" /> Trainer Information
                            </h3>
                            <div className="space-y-1">
                                <div className="flex justify-between items-center mb-1">
                                    <label className="block text-sm font-medium text-slate-200">
                                        Trainer Roblox Username <span className="text-rose-500">*</span>
                                    </label>
                                    {coTrainers.length === 0 && (
                                        <button 
                                            type="button" 
                                            onClick={addCoTrainer} 
                                            className="text-xs text-sky-400 hover:text-sky-300 font-semibold p-1 rounded-md transition flex items-center"
                                        >
                                            <Plus className="w-3 h-3 mr-1" /> Add Co-Trainer
                                        </button>
                                    )}
                                </div>
                                <input
                                    type="text"
                                    placeholder="Your Roblox username"
                                    value={trainerRobloxUsername}
                                    onChange={(e) => setTrainerRobloxUsername(e.target.value)}
                                    className="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 text-white placeholder-slate-400 focus:ring-sky-500 focus:border-sky-500"
                                    required
                                />
                            </div>

                            {/* Co-Trainer Input */}
                            {coTrainers.length === 1 && (
                                <div className="space-y-3 pt-2">
                                    <label className="block text-sm font-medium text-slate-200">Co-Trainer Roblox Username (Optional)</label>
                                    <div className="flex items-center space-x-2">
                                        <input
                                            type="text"
                                            placeholder="Co-Trainer's Roblox username"
                                            value={coTrainers[0].username}
                                            onChange={(e) => updateCoTrainer(0, e.target.value)}
                                            className="flex-grow p-3 rounded-lg bg-slate-700 border border-slate-600 text-white placeholder-slate-400 focus:ring-sky-500 focus:border-sky-500"
                                        />
                                        <button 
                                            type="button" 
                                            onClick={() => removeCoTrainer(0)} 
                                            className="p-3 text-slate-400 hover:text-rose-400 bg-slate-700 rounded-lg border border-slate-600 transition"
                                        >
                                            <Trash2 className="w-5 h-5" />
                                        </button>
                                    </div>
                                </div>
                            )}
                        </section>
                        
                        {/* Trainee Assessment Sections */}
                        <h3 className="text-xl font-bold text-white mb-4 flex items-center border-t border-slate-700 pt-6">
                            <User className="w-5 h-5 mr-2 text-sky-400" /> Trainees ({summaryText})
                        </h3>

                        <div className="space-y-8">
                            {trainees.map((trainee, index) => (
                                <TraineeAssessmentSection
                                    key={index}
                                    trainee={trainee}
                                    index={index}
                                    onUpdate={updateTrainee}
                                    onRemove={() => removeTrainee(index)}
                                    onFinalize={() => handleFinalizeTrainee(index)}
                                    onDisqualify={() => openIndividualDisqualificationModal(index)}
                                    isRemovable={trainees.length > 1}
                                    requiredFieldsValid={checkTraineeRequiredFields(trainee)}
                                />
                            ))}
                        </div>

                        <div className="flex justify-center mt-8">
                            <button
                                type="button"
                                onClick={addTrainee}
                                disabled={trainees.length >= 5 || isSaving}
                                className="flex items-center px-6 py-3 rounded-lg font-semibold text-white bg-indigo-700 hover:bg-indigo-600 transition duration-200 disabled:bg-slate-700 disabled:text-slate-500 disabled:cursor-not-allowed shadow-lg"
                            >
                                <Plus className="w-5 h-5 mr-2" /> Add Trainee (Max 5)
                            </button>
                        </div>
                        
                        {/* Status/Error Messages */}
                        {error && (
                            <div className="mt-6 p-4 bg-rose-800/50 border border-rose-600 text-rose-300 rounded-lg flex items-center">
                                <AlertTriangle className="w-5 h-5 mr-3" />
                                <p className="text-sm font-medium">{error}</p>
                            </div>
                        )}
                        {success && (
                            <div className="mt-6 p-4 bg-emerald-800/50 border border-emerald-600 text-emerald-300 rounded-lg flex items-center">
                                <Save className="w-5 h-5 mr-3" />
                                <p className="text-sm font-medium">{success}</p>
                            </div>
                        )}
                    </div>

                    {isDisqualificationModalOpen && traineeToDisqualify && (
                        <DisqualificationModal
                            trainee={traineeToDisqualify}
                            traineeIndex={traineeToDisqualifyIndex}
                            onConfirm={handleDisqualify}
                            onCancel={() => setTraineeToDisqualifyIndex(null)}
                            trainerUsername={trainerRobloxUsername}
                            isSaving={isSaving}
                        />
                    )}
                </>
            );
        };
        

        // --- NEW/MODIFIED AnnounceTrainingTab Component ---
        const AnnounceTrainingTab = ({ db, userId }) => {
            const { useState } = React;
            const [trainerName, setTrainerName] = useState('');
            const [date, setDate] = useState('');
            const [time, setTime] = useState('');
            const [requirements, setRequirements] = useState('');
            const [copyStatus, setCopyStatus] = useState(null); // 'success' or 'error'

            const generateFormat = () => {
                return (
                    `**Trainee Evaluation Announcement**\n\n` +
                    `**Trainer's Name:** ${trainerName || '__________________'}\n` +
                    `**Date:** ${date || 'DD/MM/YYYY'}\n` +
                    `**Time:** ${time || 'HH:MM (Timezone)'}\n` +
                    `**Requirements:**\n${requirements || 'Any software, links, or documents needed for the session.'}\n\n` +
                    `||@role-to-ping||`
                );
            };

            const handleCopy = () => {
                const formatText = generateFormat();
                navigator.clipboard.writeText(formatText).then(() => {
                    setCopyStatus('success');
                    setTimeout(() => setCopyStatus(null), 3000);
                }).catch(err => {
                    console.error('Failed to copy text: ', err);
                    setCopyStatus('error');
                    setTimeout(() => setCopyStatus(null), 3000);
                });
            };

            return (
                <div className="p-6 bg-slate-800 rounded-xl shadow-2xl border border-slate-700 w-full">
                    <h2 className="text-2xl font-semibold mb-6 text-white"> Training Session Announcement Format</h2>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        {/* Trainer's Name */}
                        <div className="flex flex-col">
                            <label className="text-sm font-medium text-gray-400 mb-1 flex items-center">
                                <User className="w-4 h-4 mr-2 text-blue-400" />
                                Trainer's Name
                            </label>
                            <input
                                type="text"
                                value={trainerName}
                                onChange={(e) => setTrainerName(e.target.value)}
                                className="p-3 bg-slate-700 text-white rounded-lg border border-slate-600 focus:border-blue-500 focus:ring-blue-500 transition duration-150"
                                placeholder="e.g., Jane Doe"
                            />
                        </div>

                        {/* Date */}
                        <div className="flex flex-col">
                            <label className="text-sm font-medium text-gray-400 mb-1 flex items-center">
                                <Calendar className="w-4 h-4 mr-2 text-blue-400" />
                                Date
                            </label>
                            <input
                                type="date"
                                value={date}
                                onChange={(e) => setDate(e.target.value)}
                                className="w-full p-3 bg-slate-700 text-white rounded-lg border border-slate-600 focus:border-blue-500 focus:ring-blue-500 transition duration-150"
                            />
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        {/* Time */}
                        <div className="flex flex-col">
                            <label className="text-sm font-medium text-gray-400 mb-1 flex items-center">
                                <Clock className="w-4 h-4 mr-2 text-blue-400" />
                                Time
                            </label>
                            <input
                                type="time"
                                value={time}
                                onChange={(e) => setTime(e.target.value)}
                                className="w-full p-3 bg-slate-700 text-white rounded-lg border border-slate-600 focus:border-blue-500 focus:ring-blue-500 transition duration-150"
                            />
                        </div>
                        
                        {/* Requirements */}
                        <div className="flex flex-col">
                            <label className="text-sm font-medium text-gray-400 mb-1 flex items-center">
                                <AlertCircle className="w-4 h-4 mr-2 text-blue-400" />
                                Any other Requirements
                            </label>
                            <textarea
                                rows="1"
                                value={requirements}
                                onChange={(e) => setRequirements(e.target.value)}
                                className="w-full p-3 bg-slate-700 text-white rounded-lg border border-slate-600 focus:border-blue-500 focus:ring-blue-500 transition duration-150 resize-none"
                                placeholder="e.g., Any software, links, or documents needed for the session."
                            ></textarea>
                        </div>
                    </div>


                    <h3 className="text-xl font-semibold mt-8 mb-4 text-white border-t border-slate-700 pt-6">Preview & Copy for Discord</h3>
                    
                    <div className="bg-slate-900 p-4 rounded-lg border border-slate-700 whitespace-pre-wrap font-mono text-gray-300 text-sm mb-6">
                        {generateFormat()}
                    </div>

                    <button
                        onClick={handleCopy}
                        className={`flex items-center justify-center w-full px-6 py-3 rounded-lg font-semibold text-white transition duration-200 
                            ${copyStatus === 'success' ? 'bg-green-600 hover:bg-green-700' : 'bg-blue-600 hover:bg-blue-700'}
                            ${copyStatus === 'error' ? 'bg-red-600 hover:bg-red-700' : ''}
                        `}
                    >
                        <Copy className="w-5 h-5 mr-2" />
                        {copyStatus === 'success' ? 'Copied to Clipboard!' : copyStatus === 'error' ? 'Copy Failed!' : 'Copy Format for Discord'}
                    </button>
                    
                    {copyStatus === 'success' && (
                        <p className="text-sm text-green-400 mt-2">Paste the announcement directly into Discord.</p>
                    )}

                </div>
            );
        };


        // --- VoiceVerificationTab Component (assuming existing structure) ---
        const VoiceVerificationTab = ({ db, userId }) => {
            const { useState } = React;
            const [trainees, setTrainees] = useState([initialVoiceTraineeState]);
            const [error, setError] = useState(null);
            const [success, setSuccess] = useState(false);
            const [isSaving, setIsSaving] = useState(false);

            const addTrainee = () => {
                if (trainees.length < 5) {
                    setTrainees([...trainees, initialVoiceTraineeState]);
                    setError(null);
                } else {
                    setError("Maximum of 5 voice trainees reached.");
                }
            };
            const removeTrainee = (index) => {
                if (trainees.length > 1) {
                    setTrainees(trainees.filter((_, i) => i !== index));
                }
            };
            const updateTrainee = (index, field, value) => {
                const newTrainees = trainees.map((trainee, i) => {
                    if (i === index) {
                        return { ...trainee, [field]: value };
                    }
                    return trainee;
                });
                setTrainees(newTrainees);
            };

            const handleVerifyTrainee = async (index, verifiedStatus) => {
                setError(null);
                setSuccess(false);
                const trainee = trainees[index];
                const finalStatus = verifiedStatus ? 'VERIFIED' : 'DENIED';

                if (!checkVoiceTraineeRequiredFields({...trainee, verified: verifiedStatus})) {
                    setError(`Please fill out the trainee information for Trainee #${index + 1}.`);
                    return;
                }
                
                updateTrainee(index, 'status', 'processing');
                setIsSaving(true);
                
                try {
                    const data = {
                        traineeDiscordId: trainee.traineeDiscordId.trim(),
                        traineeRobloxUsername: trainee.traineeRobloxUsername.trim(),
                        traineeName: trainee.traineeName.trim(),
                        verified: verifiedStatus,
                        timestamp: mockServerTimestamp(),
                        userId: userId,
                        status: finalStatus,
                        batchId: crypto.randomUUID(),
                    };
                    await mockAddDoc(data);
                    
                    updateTrainee(index, 'status', finalStatus.toLowerCase());
                    setSuccess(`Trainee #${index + 1} (${finalStatus}) result saved successfully!`);
                    setTimeout(() => setSuccess(false), 5000);
                } catch (err) {
                    console.error("Error saving voice verification:", err);
                    setError(`Failed to save result for Trainee #${index + 1}. Check console for details.`);
                    updateTrainee(index, 'status', 'pending');
                } finally {
                    setIsSaving(false);
                }
            };

            const TraineeVoiceAssessmentSection = ({ trainee, index, onUpdate, onRemove, onFinalize, isRemovable, isReady }) => {
                let statusClasses = "text-sm font-semibold px-3 py-1 rounded-full";
                let statusText = "Pending";

                if (trainee.status === 'verified') {
                    statusClasses += " bg-emerald-600 text-white";
                    statusText = "VERIFIED";
                } else if (trainee.status === 'denied') {
                    statusClasses += " bg-rose-600 text-white";
                    statusText = "DENIED";
                } else if (trainee.status === 'processing') {
                    statusClasses += " bg-sky-600 text-white";
                    statusText = "Processing...";
                } else {
                    statusClasses += " bg-slate-600 text-white";
                }
                
                const isValid = trainee.traineeDiscordId && trainee.traineeRobloxUsername && trainee.traineeName;

                return (
                    <section 
                        className="space-y-4 p-5 bg-slate-700 rounded-xl border border-slate-600 relative"
                        style={trainee.status !== 'pending' ? {opacity: 0.7} : {}} 
                    >
                        <h3 className="text-xl font-bold text-white mb-4 flex justify-between items-center">
                            Voice Trainee #{index + 1}
                            {isRemovable && (
                                <button
                                    type="button"
                                    onClick={onRemove}
                                    className="text-rose-400 hover:text-rose-300 p-1 rounded-full hover:bg-slate-600 transition"
                                >
                                    <Trash2 className="w-5 h-5" />
                                </button>
                            )}
                        </h3>

                        {/* Trainee Information */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 pb-4 border-b border-slate-600">
                            <div className="space-y-1">
                                <label className="block text-sm font-medium text-slate-200">Discord ID (Numbers Only) <span className="text-rose-500">*</span></label>
                                <input
                                    type="number"
                                    placeholder="123456789012345678"
                                    value={trainee.traineeDiscordId}
                                    onChange={(e) => onUpdate('traineeDiscordId', e.target.value)}
                                    className="w-full p-3 rounded-lg bg-slate-800 border border-slate-600 text-white placeholder-slate-400 focus:ring-sky-500 focus:border-sky-500"
                                    required
                                />
                            </div>
                            <div className="space-y-1">
                                <label className="block text-sm font-medium text-slate-200">Roblox Username <span className="text-rose-500">*</span></label>
                                <input
                                    type="text"
                                    placeholder="Trainee's Roblox username"
                                    value={trainee.traineeRobloxUsername}
                                    onChange={(e) => onUpdate('traineeRobloxUsername', e.target.value)}
                                    className="w-full p-3 rounded-lg bg-slate-800 border border-slate-600 text-white placeholder-slate-400 focus:ring-sky-500 focus:border-sky-500"
                                    required
                                />
                            </div>
                            <div className="space-y-1">
                                <label className="block text-sm font-medium text-slate-200">Name <span className="text-rose-500">*</span></label>
                                <input
                                    type="text"
                                    placeholder="Trainee's display name"
                                    value={trainee.traineeName}
                                    onChange={(e) => onUpdate('traineeName', e.target.value)}
                                    className="w-full p-3 rounded-lg bg-slate-800 border border-slate-600 text-white placeholder-slate-400 focus:ring-sky-500 focus:border-sky-500"
                                    required
                                />
                            </div>
                        </div>

                        {/* Action Buttons */}
                        <div className="pt-4 border-t border-slate-600">
                            <h4 className="text-lg font-bold text-white mb-3 flex items-center"><Volume2 className="w-4 h-4 mr-2 text-sky-400" /> Verification Result</h4>
                            <div className="flex items-center justify-between">
                                <span className={statusClasses}>{statusText}</span>
                                {trainee.status === 'pending' && (
                                    <div className="flex space-x-3">
                                        <button
                                            type="button"
                                            onClick={() => onFinalize(index, false)}
                                            disabled={!isValid || isSaving}
                                            className="flex items-center bg-rose-700 hover:bg-rose-600 text-white font-medium py-2 px-4 rounded-lg text-sm transition duration-200 disabled:bg-slate-700 disabled:text-slate-500 disabled:cursor-not-allowed shadow-md"
                                        >
                                            <XCircle className="w-4 h-4 mr-1" /> Deny
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => onFinalize(index, true)}
                                            disabled={!isValid || isSaving}
                                            className="flex items-center bg-emerald-700 hover:bg-emerald-600 text-white font-medium py-2 px-4 rounded-lg text-sm transition duration-200 disabled:bg-slate-700 disabled:text-slate-500 disabled:cursor-not-allowed shadow-md"
                                        >
                                            <Save className="w-4 h-4 mr-1" /> Verify
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </section>
                );
            };

            const processedTrainees = trainees.filter(t => t.status !== 'pending' && t.status !== 'processing').length;
            const verifiedTrainees = trainees.filter(t => t.status === 'verified').length;
            const summaryText = `${processedTrainees}/${trainees.length} Trainees Processed, ${verifiedTrainees} Verified`;

            return (
                <div className="p-6 bg-slate-800 rounded-xl shadow-2xl border border-slate-700 w-full">
                    <h2 className="text-2xl font-bold text-white mb-6 flex items-center">
                        <Mic className="w-6 h-6 mr-2 text-sky-400" /> Voice Verification Results
                    </h2>
                    <p className="text-slate-400 mb-6 border-b border-slate-700 pb-4"> 
                        Log results for trainees who attempted voice verification. ({summaryText}) 
                    </p>

                    <div className="space-y-8">
                        {trainees.map((trainee, index) => (
                            <TraineeVoiceAssessmentSection
                                key={index}
                                trainee={trainee}
                                index={index}
                                onUpdate={updateTrainee}
                                onRemove={() => removeTrainee(index)}
                                onFinalize={handleVerifyTrainee}
                                isRemovable={trainees.length > 1}
                            />
                        ))}
                    </div>

                    <div className="flex justify-center mt-8">
                        <button
                            type="button"
                            onClick={addTrainee}
                            disabled={trainees.length >= 5 || isSaving}
                            className="flex items-center px-6 py-3 rounded-lg font-semibold text-white bg-indigo-700 hover:bg-indigo-600 transition duration-200 disabled:bg-slate-700 disabled:text-slate-500 disabled:cursor-not-allowed shadow-lg"
                        >
                            <Plus className="w-5 h-5 mr-2" /> Add Voice Trainee (Max 5)
                        </button>
                    </div>

                    {/* Status/Error Messages */}
                    {error && (
                        <div className="mt-6 p-4 bg-rose-800/50 border border-rose-600 text-rose-300 rounded-lg flex items-center">
                            <AlertTriangle className="w-5 h-5 mr-3" />
                            <p className="text-sm font-medium">{error}</p>
                        </div>
                    )}
                    {success && (
                        <div className="mt-6 p-4 bg-emerald-800/50 border border-emerald-600 text-emerald-300 rounded-lg flex items-center">
                            <Save className="w-5 h-5 mr-3" />
                            <p className="text-sm font-medium">{success}</p>
                        </div>
                    )}
                </div>
            );
        };


        // --- Main App Component ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('results'); // Default tab
            const [userId] = useState(crypto.randomUUID()); // Mocked user ID
            const db = {}; // Mocked database object

            return (
                <div className="min-h-screen p-4 md:p-10 flex justify-center items-start">
                    <div className="w-full max-w-4xl">
                        {/* Tab Navigation */}
                        <div className="flex space-x-2 p-2 bg-slate-800 rounded-xl mb-6 shadow-xl border border-slate-700">
                            <TabButton
                                icon={MessageSquare}
                                label="Announcement"
                                isActive={activeTab === 'announcement'}
                                onClick={() => setActiveTab('announcement')}
                            />
                            <TabButton
                                icon={List}
                                label="Submit Results"
                                isActive={activeTab === 'results'}
                                onClick={() => setActiveTab('results')}
                            />
                            <TabButton
                                icon={Mic}
                                label="Voice Verification"
                                isActive={activeTab === 'voice'}
                                onClick={() => setActiveTab('voice')}
                            />
                        </div>

                        {/* Conditional Content Rendering */}
                        {activeTab === 'results' && (
                            <EvaluationForm db={db} userId={userId} />
                        )}

                        {activeTab === 'announcement' && (
                            <AnnounceTrainingTab db={db} userId={userId} />
                        )}

                        {activeTab === 'voice' && (
                            <VoiceVerificationTab db={db} userId={userId} />
                        )}
                    </div>
                </div>
            );
        };

        // Render the App component to the root element
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);

    </script>

</body>
</html>
