<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HRBRP | Training Assist</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script>
        const CONFIG = {
            WEBHOOK_URL: "https://discord.com/api/webhooks/1452656413481636054/k1pmvQg7-qFWBJi6ESho0m3dzGu3v8OtgMIZWs7DFIxqL2CZHDAotzM0io2FTNXkEWum",
            ANNOUNCE_ROLE_ID: "1452651642850775082",
            ACCESS_KEY: "MerseBigBlackOldFatDonkeyNoobBot"
        };
    </script>
    <style>
        :root {
            --bg: #05070a;
            --panel: rgba(16, 20, 35, 0.95);
            --pink: #ff00ff;
            --blue: #00f2ff;
            --gold: #ffcc00;
            --pass: #00ff88;
            --fail: #ff4444;
            --text: #ffffff;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at top right, #1a0b2e, #05070a);
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #login-screen {
            background: var(--panel);
            padding: 50px;
            border: 2px solid var(--pink);
            border-radius: 20px;
            text-align: center;
        }

        #dashboard {
            display: none;
            width: 95%;
            max-width: 1100px;
            background: var(--panel);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .tabs { display: flex; background: rgba(0,0,0,0.4); }
        .tab {
            flex: 1; padding: 20px; text-align: center; cursor: pointer;
            color: #666; font-weight: 800; text-transform: uppercase;
            font-size: 0.85rem;
        }
        .tab.active { color: var(--blue); border-bottom: 3px solid var(--blue); background: rgba(0, 242, 255, 0.05); }

        .content { padding: 40px; display: none; }
        .content.active { display: block; }

        label { display: block; margin-top: 15px; color: var(--blue); font-size: 0.75rem; font-weight: 800; text-transform: uppercase; }
        input, textarea, select {
            background: rgba(0,0,0,0.4); border: 1px solid var(--blue);
            color: white; padding: 12px; width: 100%; border-radius: 8px; margin-top: 5px; font-family: inherit;
        }

        .toggle-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
        .t-btn {
            padding: 12px; cursor: pointer; border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05); color: white; border-radius: 8px; font-weight: bold; font-size: 0.75rem;
        }
        .t-btn.yes-active { background: var(--pass); color: #000; }
        .t-btn.no-active { background: var(--fail); color: #fff; }

        .primary-btn {
            background: var(--blue); color: black; border: none; padding: 18px; width: 100%;
            border-radius: 12px; font-weight: 800; cursor: pointer; margin-top: 25px; text-transform: uppercase;
        }
        .primary-btn:disabled { background: #444 !important; color: #888 !important; cursor: not-allowed; }
        
        .edit-btn { background: var(--gold); color: black; border: none; padding: 8px 15px; border-radius: 5px; font-weight: bold; cursor: pointer; margin-right: 5px; }

        #batch-list { margin-top: 30px; display: grid; grid-template-columns: 1fr; gap: 15px; }
        .batch-card {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1);
            padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center;
        }
    </style>
</head>
<body>

    <div id="login-screen">
        <h1 style="color: var(--gold); font-weight: 800;">HRBRP | Training Assist</h1>
        <input type="password" id="pass-field" style="text-align:center" placeholder="ACCESS KEY">
        <button onclick="unlock()" class="primary-btn">INITIALIZE</button>
    </div>

    <div id="dashboard">
        <div class="tabs">
            <div class="tab active" id="tab-ann" onclick="switchTab('ann')">Announcements</div>
            <div class="tab" id="tab-res" onclick="switchTab('res')">Training Results</div>
            <div class="tab" id="tab-voice" onclick="switchTab('voice')">Voice Verification</div>
        </div>

        <div id="ann-content" class="content active">
            <h2>BROADCAST SYSTEM</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div><label>Trainer Discord ID</label><input type="text" id="ann-uid"></div>
                <div><label>Location</label><input type="text" id="ann-loc" value="Sheiff Breafing Room"></div>
            </div>
            <label>Start Time (Local)</label>
            <input type="datetime-local" id="ann-time">
            <label>Notes</label>
            <textarea id="ann-info" rows="3"></textarea>
            <button id="ann-btn" onclick="postAnn()" class="primary-btn">SEND BROADCAST</button>
        </div>

        <div id="res-content" class="content">
            <h2>BATCH EVALUATOR</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px;">
                <div><label>Host Roblox</label><input type="text" id="h-rblx" oninput="saveHost()"></div>
                <div><label>Host Discord ID</label><input type="text" id="h-id" oninput="saveHost()"></div>
            </div>

            <div style="margin-top: 30px; padding: 25px; border: 1px solid var(--pink); border-radius: 20px;">
                <h3 id="form-title" style="color: var(--pink); margin-top: 0;">TRAINEE INPUT</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <input type="text" id="t-rblx" placeholder="Roblox Username">
                    <input type="text" id="t-id" placeholder="Discord User ID">
                </div>
                <label>Knowledge (Max 10)</label>
                <input type="number" id="t-know" max="10" min="0">
                <label>Knowledge Notes</label>
                <textarea id="t-know-notes" rows="2"></textarea>
                <div class="toggle-row">
                    <div><label>SPAG</label><div style="display:flex;gap:5px"><button class="t-btn" id="s-y" onclick="setTog('spag',true)">Y</button><button class="t-btn" id="s-n" onclick="setTog('spag',false)">N</button></div></div>
                    <div><label>HEALED</label><div style="display:flex;gap:5px"><button class="t-btn" id="h-y" onclick="setTog('heal',true)">Y</button><button class="t-btn" id="h-n" onclick="setTog('heal',false)">N</button></div></div>
                    <div><label>Punshied Accordinly?</label><div style="display:flex;gap:5px"><button class="t-btn" id="p-y" onclick="setTog('punish',true)">Y</button><button class="t-btn" id="p-n" onclick="setTog('punish',false)">N</button></div></div>
                    <div><label>Used Proper Evidence?</label><div style="display:flex;gap:5px"><button class="t-btn" id="e-y" onclick="setTog('evid',true)">Y</button><button class="t-btn" id="e-n" onclick="setTog('evid',false)">N</button></div></div>
                </div>
                <label>Mod-Call Notes</label>
                <textarea id="t-mod-notes" rows="2"></textarea>
                <button id="add-btn" onclick="addOrUpdateTrainee()" class="primary-btn" style="background: var(--pass)">ADD/UPDATE TRAINEE</button>
            </div>
            <div id="batch-list"></div>
            <button id="publish-btn" onclick="publish()" class="primary-btn" style="background: var(--pink); color: white; display: none;">PUBLISH ALL RESULTS</button>
        </div>

        <div id="voice-content" class="content">
            <h2>VOICE VERIFICATION UNIT</h2>
            <label>Trainer Discord ID</label>
            <input type="text" id="v-trainer-uid">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                <div><label>Trainee Discord ID</label><input type="text" id="v-trainee-uid"></div>
                <div><label>Trainee Username</label><input type="text" id="v-trainee-name"></div>
            </div>
            <label>Age Range</label>
            <select id="v-age">
                <option value="Under 13">Under 13 (Fail)</option>
                <option value="13-15">13-15</option>
                <option value="15-17">15-17</option>
                <option value="18+">18+</option>
            </select>
            <button onclick="postVoiceVerify()" class="primary-btn" style="background: var(--gold); color: black;">SUBMIT VERIFICATION</button>
        </div>
    </div>

    <script>
        let batch = [];
        let toggles = { spag: null, heal: null, punish: null, evid: null };
        let editingIndex = -1;
        let trainerCooldowns = {};

        function unlock() {
            if(document.getElementById('pass-field').value === CONFIG.ACCESS_KEY) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                loadHost();
            } else { alert("ACCESS DENIED"); }
        }

        function saveHost() {
            localStorage.setItem('hr_host_rblx', document.getElementById('h-rblx').value);
            localStorage.setItem('hr_host_id', document.getElementById('h-id').value);
        }

        function loadHost() {
            document.getElementById('h-rblx').value = localStorage.getItem('hr_host_rblx') || "";
            document.getElementById('h-id').value = localStorage.getItem('hr_host_id') || "";
        }

        function switchTab(t) {
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(t + '-content').classList.add('active');
            document.getElementById('tab-' + t).classList.add('active');
        }

        function setTog(k, v) {
            toggles[k] = v;
            const p = k.charAt(0);
            document.getElementById(p + '-y').className = v ? 't-btn yes-active' : 't-btn';
            document.getElementById(p + '-n').className = !v ? 't-btn no-active' : 't-btn';
        }

        function addOrUpdateTrainee() {
            const rblx = document.getElementById('t-rblx').value;
            if(!rblx) return alert("Username required.");
            
            let knowRaw = parseInt(document.getElementById('t-know').value) || 0;
            if (knowRaw > 10) knowRaw = 10; 

            const mod = Object.values(toggles).filter(v => v === true).length * 2.5;
            const total = knowRaw + mod;
            const data = {
                rblx, id: document.getElementById('t-id').value || "N/A",
                score: total, status: total >= 14 ? "PASS" : "FAIL",
                knowNotes: document.getElementById('t-know-notes').value || "N/A",
                modNotes: document.getElementById('t-mod-notes').value || "N/A",
                rawToggles: {...toggles}, rawKnow: knowRaw
            };

            if(editingIndex > -1) {
                batch[editingIndex] = data;
                editingIndex = -1;
            } else {
                if(batch.length < 5) batch.push(data);
                else alert("Max 5 trainees.");
            }
            renderBatch(); clearForm();
        }

        function editTrainee(index) {
            const t = batch[index];
            editingIndex = index;
            document.getElementById('t-rblx').value = t.rblx;
            document.getElementById('t-id').value = t.id;
            document.getElementById('t-know').value = t.rawKnow;
            document.getElementById('t-know-notes').value = t.knowNotes;
            document.getElementById('t-mod-notes').value = t.modNotes;
            toggles = {...t.rawToggles};
            Object.keys(toggles).forEach(k => {
                if(toggles[k] !== null) setTog(k, toggles[k]);
            });
            window.scrollTo(0, 0);
        }

        function renderBatch() {
            const out = document.getElementById('batch-list');
            out.innerHTML = batch.length ? "<h3>CURRENT BATCH</h3>" : "";
            batch.forEach((t, i) => {
                out.innerHTML += `<div class="batch-card">
                    <div><strong>${t.rblx}</strong> (${t.status})</div>
                    <div>
                        <button class="edit-btn" onclick="editTrainee(${i})">EDIT</button>
                        <button class="t-btn no-active" onclick="batch.splice(${i},1);renderBatch()">‚úï</button>
                    </div>
                </div>`;
            });
            document.getElementById('publish-btn').style.display = batch.length ? 'block' : 'none';
        }

        function clearForm() {
            ['t-rblx', 't-id', 't-know', 't-know-notes', 't-mod-notes'].forEach(id => document.getElementById(id).value = "");
            toggles = { spag: null, heal: null, punish: null, evid: null };
            document.querySelectorAll('.t-btn').forEach(b => { if(b.innerText !== '‚úï') b.className = 't-btn'; });
        }

        async function postAnn() {
            const uid = document.getElementById('ann-uid').value;
            if(!uid) return alert("Enter Trainer Discord ID.");
            const now = Date.now();
            if(trainerCooldowns[uid] && now < trainerCooldowns[uid]) {
                const wait = Math.ceil((trainerCooldowns[uid] - now) / 1000);
                return alert(`Cooldown: Wait ${wait}s.`);
            }
            const timeVal = document.getElementById('ann-time').value;
            const unix = Math.floor(new Date(timeVal).getTime() / 1000);
            await fetch(CONFIG.WEBHOOK_URL, {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    content: `<@${uid}> <@&${CONFIG.ANNOUNCE_ROLE_ID}>`,
                    embeds: [{ title: "‚öîÔ∏è TRAINING ANNOUNCEMENT", color: 16711935, fields: [{ name: "‚è∞ Start Time", value: `<t:${unix}:F>` }, { name: "üìç Location", value: document.getElementById('ann-loc').value }] }]
                })
            });
            trainerCooldowns[uid] = now + (5 * 60 * 1000);
            alert("Broadcast sent.");
        }

        async function postVoiceVerify() {
            const tID = document.getElementById('v-trainer-uid').value;
            const trID = document.getElementById('v-trainee-uid').value;
            const ageRange = document.getElementById('v-age').value;
            const isUnderage = ageRange === "Under 13";
            const body = {
                content: `<@${tID}> <@${trID}>`,
                embeds: [{
                    title: `üé§ VOICE VERIFICATION ${isUnderage ? "FAILED" : "SUCCESS"}`, 
                    color: isUnderage ? 16711680 : 16763904,
                    fields: [
                        { name: "Trainer", value: `<@${tID}>`, inline: true },
                        { name: "Trainee", value: `${document.getElementById('v-trainee-name').value} (<@${trID}>)`, inline: true },
                        { name: "Age Bracket", value: `**${ageRange}**`, inline: true }
                    ]
                }]
            };
            await fetch(CONFIG.WEBHOOK_URL, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(body) });
            alert("Verification Broadcast Sent.");
        }

        async function publish() {
            const btn = document.getElementById('publish-btn');
            btn.disabled = true;
            let timeLeft = 30;
            const timer = setInterval(() => {
                timeLeft--; btn.innerText = `WAIT ${timeLeft}S...`;
                if (timeLeft <= 0) { clearInterval(timer); btn.disabled = false; btn.innerText = "PUBLISH ALL RESULTS"; }
            }, 1000);

            const embeds = batch.map(t => ({
                title: `TRAINING EVALUATION: ${t.status}`, color: t.status === "PASS" ? 65280 : 16711680,
                fields: [ { name: "Candidate", value: t.rblx, inline: true }, { name: "Score", value: `${t.score}/20`, inline: true }, { name: "Knowledge", value: t.knowNotes }, { name: "Mod-Call", value: t.modNotes } ],
                footer: { text: "Host: " + document.getElementById('h-rblx').value }
            }));
            await fetch(CONFIG.WEBHOOK_URL, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ embeds }) });
            alert("Published."); batch = []; renderBatch();
        }
    </script>
</body>
</html>
